# 🚨 今すぐデプロイ手順

## 現状
- ✅ コードは最新版に更新済み
- ❌ デプロイが古いまま（GETテストで古いレスポンスが返る）

## 必須手順

### 1. Apps Script で保存確認
1. `Ctrl+S` (Mac: `Cmd+S`) を押す
2. 「保存しました」メッセージを確認

### 2. 新バージョンでデプロイ（重要！）

**手順A: 既存デプロイを更新（推奨）**
1. 「デプロイ」→「デプロイを管理」をクリック
2. 既存デプロイの **鉛筆アイコン（編集）** をクリック
3. **「バージョン」ドロップダウン** を開く
4. **「新バージョン」** を選択 ← ここが最重要！
5. 説明（任意）: `名刺パターン対応`
6. アクセスできるユーザー: **「全員」** を確認
7. **「デプロイ」** ボタンをクリック

**手順B: 完全に新規デプロイ（代替案）**
1. 「デプロイ」→「新しいデプロイ」
2. 種類: ウェブアプリ
3. 説明: `レシート v2 名刺パターン`
4. 次のユーザーとして実行: **自分**
5. アクセスできるユーザー: **全員**
6. 「デプロイ」をクリック
7. **新しいURL** をコピー
8. GPTs Actions の `servers.url` を新URLに更新

### 3. デプロイ確認

ターミナルで以下を実行:

```bash
curl -s -L "https://script.google.com/macros/s/AKfycbz0jm4j35inhtNs-BD0HpVx9yYef7smxZrX6TeuwZJZDICm5xVJr0eQEDv0d5lpyMnH/exec"
```

**期待する結果:**
```json
{"message":"Receipt Scanner API is running - v2.0.0-ultimate"}
```

**現在の結果（間違い）:**
```json
{"success":true,"message":"Receipt Scanner API is running","version":"2.0.0-ultimate"}
```

期待する結果が返るまで、手順2を繰り返してください。

---

## よくある間違い

❌ **コードを保存しただけでデプロイしていない**
→ 保存≠デプロイ。必ず「新バージョン」でデプロイが必要

❌ **「新バージョン」を選択していない**
→ 既存バージョンを選んでも更新されません

❌ **デプロイ後に確認していない**
→ 必ずGETテストで新レスポンスを確認

---

## トラブルシューティング

### Q: 「新バージョン」でデプロイしたのに変わらない

A: キャッシュの可能性
1. 5分待つ
2. または完全に新規デプロイ（手順B）を実行

### Q: 新規デプロイしたらURLが変わった

A: それで正解です
1. 新しいURLをコピー
2. `gpts/actions_schema_ultimate.json` の `servers.url` を更新
3. GPTs Actions に新スキーマを貼り付け

---

デプロイ完了後、必ずこのファイルに記載の確認コマンドを実行してください。
